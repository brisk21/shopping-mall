<!DOCTYPE html >
<html lang="zh">
<head>
<title>订单详情</title>
  <{include file="public/header" /}>
  <style>
    .pay{
      width: 45%;float: left;
      margin-top:unset !important;
      margin-left: 10px;
    }
    .mg10-0 {
      margin: 10px 0;
      overflow: hidden;
      text-align: center;
    }

  </style>
</head>
<body ontouchstart>
<!--主体-->
<header class="wy-header">
  <div class="wy-header-icon-back"><span></span></div>
  <div class="wy-header-title">订单详情</div>
</header>
<div class="weui-content">
  <div class="wy-media-box weui-media-box_text address-select">
    <div class="weui-media-box_appmsg">
      <div class="weui-media-box__hd proinfo-txt-l" style="width:20px;"><span class="promotion-label-tit">
        <img src="/static/mall/images/icon_nav_city.png" /></span></div>
      <div class="weui-media-box__bd">
        <a href=""  class="weui-cell_access addr">
          <h4 class="address-name"><span class="addr-username"></span><span class="addr-mobile"></span></h4>
          <div class="address-txt addr-detail"></div>
        </a>
      </div>
      <div class="weui-media-box__hd proinfo-txt-l" style="width:16px;"><div class="weui-cell_access"></div></div>
    </div>
  </div>
  <div class="wy-media-box weui-media-box_text">
    <div class="weui-media-box__bd " id="pro-list">


    </div>
  </div>
  <div class="wy-media-box weui-media-box_text">
    <div class="mg10-0 t-c">总金额：<span class="wy-pro-pri mg-tb-5">¥<em class="num font-20 totalMoney">0.00</em></span></div>
    <div class="mg10-0 btn-div"><a href="javascript:create('wechat')" class="weui-btn weui-btn_primary pay">微信付款</a> <a href="javascript:create('credit')" class="weui-btn weui-btn_default pay pay_credit">余额支付</a></div>
  </div>
</div>
<{include file="public/footer" /}>

<script>
  var order_sn = bs_get_param('order_sn')
  getData();
  function getData() {
    bs_request("<{:url('/mall/order/detail')}>",{order_sn:order_sn,},function (res) {
      if (res.code != 0){
        return $.alert(res.msg);
      }
      $(".addr").attr('href',"javascript:void(0)")
      if (res.data.address){
        $(".addr-username").html(res.data.address.username);
        $(".addr-mobile").html(res.data.address.mobile);
        $(".addr-detail").html(res.data.address.province+' '+res.data.address.city+' '+res.data.address.area+' '+res.data.address.address);
      }else {
        $(".address-select").remove();

      }
      var goods = res.data.goods_list;

      for (var i=0;i<goods.length;i++){
        var item = ' <div class="weui-media-box_appmsg ord-pro-list">\n' +
                '        <div class="weui-media-box__hd"><a href="<{:url(\'/mall/goods/detail\')}>?id='+goods[i].goods_id+'"><img class="weui-media-box__thumb" src="'+goods[i].thumb+'" alt=""></a></div>\n' +
                '        <div class="weui-media-box__bd">\n' +
                '          <h1 class="weui-media-box__desc"><a href="<{:url(\'/mall/goods/detail\')}>?id='+goods[i].goods_id+'" class="ord-pro-link">'+goods[i].title+'</a></h1>\n' +
                '          <!--<p class="weui-media-box__desc">规格：<span>红色</span>，<span>23</span></p>-->\n' +
                '          <div class="clear mg-t-10">\n' +
                '            <div class="wy-pro-pri fl">¥<em class="num font-15">'+goods[i].price+'</em></div>\n' +
                '            <div class="pro-amount fr"><span class="font-13">数量×<em class="name">'+goods[i].count+'</em></span></div>\n' +
                '          </div>\n' +
                '        </div>\n' +
                '      </div>';


        $("#pro-list").append(item)
      }

      if (res.data.order.status !=0){
        $(".btn-div").hide()
      }
      $(".totalMoney").text(res.data.order.price);

    });
  }

  function create(type){
    if (type=='credit'){
      return $.confirm("确定用余额支付吗？",function () {
        //发起支付
        bs_request("<{:url('/mall/order/pay')}>",{order_sn:order_sn,payType:'credit'},function (ret){
          if (ret.code==0){
            $.toast(ret.msg,function () {
              location.href = "<{:url('/mall/order/all_orders',['status'=>'1'])}>"
            })
          }else {
            return $.alert(ret.msg);
          }
        })
      })
    }else {

        //todo 发起支付
        $.alert('微信支付未接入')

    }


  }
</script>
</body>
</html>
